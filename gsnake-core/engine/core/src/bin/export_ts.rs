use gsnake_core::{
    CellType, Direction, Frame, GameState, GameStatus, GridSize, LevelDefinition, Position, Snake,
};
use std::{fs, path::PathBuf};
use ts_rs::TS;

fn write_type<T: TS>(buffer: &mut String) {
    buffer.push_str("export ");
    buffer.push_str(&T::decl());
    buffer.push('\n');
}

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let out_path = PathBuf::from(env!("CARGO_MANIFEST_DIR"))
        .join("../../../gsnake-web/types/models.ts");

    if let Some(parent) = out_path.parent() {
        fs::create_dir_all(parent)?;
    }

    let mut buffer = String::new();
    buffer.push_str(
        "// This file was generated by ts-rs. Do not edit this file manually.\n\n",
    );

    write_type::<Position>(&mut buffer);
    write_type::<GridSize>(&mut buffer);
    write_type::<Direction>(&mut buffer);
    write_type::<CellType>(&mut buffer);
    write_type::<GameStatus>(&mut buffer);
    write_type::<Snake>(&mut buffer);
    write_type::<LevelDefinition>(&mut buffer);
    write_type::<GameState>(&mut buffer);
    write_type::<Frame>(&mut buffer);

    fs::write(out_path, buffer)?;
    Ok(())
}
