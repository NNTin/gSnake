# Ralph Progress Log
Started: Tue Jan 27 22:11:52 CET 2026
## Codebase Patterns
- **Git Dependencies**: Use branch-based git dependencies for submodules (not tags/commits)
- **npm Git Subdirectory Limitation**: npm does NOT support git dependencies for subdirectories - package.json must be at repo root
- **Auto-detection**: Build scripts check for ../.git and sibling submodules to detect root repo context
- **Rust Overrides**: Use .cargo/config.toml with [patch] section to override git deps with local paths
- **JavaScript Overrides**: Use preinstall scripts to dynamically modify package.json based on detection
- **CI Strategy**: Per-submodule CI validates standalone builds; root CI validates integration
- **nektos/act**: Use act for local CI testing - compatible with standard GitHub Actions
- **Documentation Location**: gsnake-specs/tasks/repo-architecture.md is the central doc for dependency architecture
- **"Typecheck passes"**: For markdown-only changes, this means ensuring valid markdown syntax (no specific command)
- **Prebuilt WASM**: WASM artifacts are committed to enable standalone builds without requiring wasm-pack locally
---

## 2026-01-27 22:15 - US-001
- Implemented comprehensive "Dependency Resolution Strategy" section in gsnake-specs/tasks/repo-architecture.md
- Files changed: gsnake-specs/tasks/repo-architecture.md
- **Learnings for future iterations:**
  - The repo-architecture.md file is the central documentation for dependency management
  - Documentation should include both Rust (Cargo.toml) and JavaScript (package.json) examples
  - Auto-detection mechanism is a key feature: checks for ../.git to determine root repo context
  - Acceptance criteria "Typecheck passes" refers to ensuring markdown syntax is valid (no specific typecheck command in root)
---

## 2026-01-27 22:17 - US-002
- Implemented comprehensive "Troubleshooting" section in gsnake-specs/tasks/repo-architecture.md
- Files changed: gsnake-specs/tasks/repo-architecture.md
- **Learnings for future iterations:**
  - Troubleshooting section covers 5 main categories: git deps not found, local override not working, WASM build fails, forcing standalone mode, verifying dependency mode
  - Each troubleshooting item includes symptoms, causes/solutions, and verification commands
  - Important to provide both Rust and JavaScript examples for verification commands
---

## 2026-01-27 22:20 - US-003
- Updated architecture Mermaid diagram in gsnake-specs/tasks/repo-architecture.md
- Files changed: gsnake-specs/tasks/repo-architecture.md
- **Learnings for future iterations:**
  - Mermaid diagram now clearly shows two modes: Root Repository (local paths) and Standalone (git deps)
  - Used emojis (üè† and üåê) and color coding to visually distinguish the modes
  - Removed old "cannot build alone" pain points - now marked as resolved
  - Added legend explaining dependency types
  - Diagram is more focused and easier to understand than the previous version
---

## 2026-01-27 23:00 - US-004
- Validated gsnake-core standalone build capabilities
- All build commands tested and passed:
  - cargo build: successful
  - cargo test: 62 tests passed
  - cargo doc --no-deps: documentation generated
  - wasm-pack build: WASM bindings compiled successfully
- Updated gsnake-core/README.md with comprehensive standalone build instructions
- Files changed: gsnake-core/README.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- **Learnings for future iterations:**
  - gsnake-core is a Rust workspace with 3 members (core, cli, wasm)
  - Profile warnings for non-root packages in workspaces are expected and harmless
  - WASM build requires wasm-pack and wasm32-unknown-unknown target
  - WASM output goes to engine/bindings/wasm/pkg/
  - All tests run in workspace context (62 total tests across all crates)
  - The README should document prerequisites, build commands, and known issues
  - gsnake-core has no external git dependencies - all dependencies are from crates.io
---

## 2026-01-27 23:00 - US-005
- Implemented comprehensive CI workflow for gsnake-core
- Created gsnake-core/.github/workflows/ci.yml with three jobs:
  - **build**: Validates cargo build with Rust stable
  - **test**: Runs cargo test on all workspace crates
  - **wasm**: Builds WASM bindings with wasm-pack
- All jobs use actions/checkout@v4, dtolnay/rust-toolchain@stable
- Added caching for cargo registry, index, and build artifacts for faster CI runs
- Tested workflow syntax validation with nektos/act dryrun
- Files changed: gsnake-core/.github/workflows/ci.yml, gsnake-core/README.md
- **Learnings for future iterations:**
  - gsnake-core is NOT a git submodule - it's a directory in the root repo (no .git file/dir)
  - Changes must be committed from root repo, not from within gsnake-core directory
  - nektos/act requires Docker and interactive configuration on first run
  - act config file location: ~/.config/act/actrc
  - Use medium-sized image: `ghcr.io/catthehacker/ubuntu:act-latest` (~500MB)
  - act dryrun is useful for validating workflow syntax without running full jobs
  - Known act limitations: cache actions may not work exactly as on GitHub, network operations differ
  - CI workflow should checkout to `path: gsnake-core` to maintain directory structure
  - workflow_dispatch trigger cannot be tested locally with act
  - Added CI/CD section to README.md with act usage instructions and limitations
---

## 2026-01-27 23:05 - US-006
- Updated gsnake-levels/Cargo.toml to use git dependency for gsnake-core
- Git dependency format: `git = "https://github.com/nntin/gsnake", branch = "main", package = "gsnake-core"`
- Created .cargo/config.toml with `git-fetch-with-cli = true` to handle SSH submodule authentication
- Updated render.rs to gracefully handle standalone mode (checks if sibling gsnake-core exists)
- cargo build, cargo test, and cargo check all pass successfully
- Files changed: gsnake-levels/Cargo.toml, gsnake-levels/Cargo.lock, gsnake-levels/.cargo/config.toml, gsnake-levels/README.md, gsnake-levels/src/render.rs
- **Learnings for future iterations:**
  - gsnake-levels IS a git submodule (unlike gsnake-core) - changes must be committed in submodule, then root
  - Git dependencies that point to repos with SSH submodules require `git-fetch-with-cli = true` in .cargo/config.toml
  - The gsnake repo has SSH submodules (git@github.com URLs) which cause cargo authentication issues without git-fetch-with-cli
  - render.rs `replay` and `render` commands need sibling gsnake-core - updated to check path exists and provide helpful error
  - Best practice: check for sibling paths at runtime and provide clear error messages for standalone vs root repo contexts
  - Document git dependency configuration and root repo requirements in README.md
---

## 2026-01-27 23:15 - US-007
- Implemented local override detection for gsnake-levels via build.rs
- Created build.rs that auto-detects root repository context by checking:
  - ../.git exists (root repo)
  - ../gsnake-core/Cargo.toml exists (sibling directory, not .git since gsnake-core is not a submodule)
- Build script generates .cargo/config.toml with [patch] section pointing to ../gsnake-core/engine/core
- Cargo build succeeds in both modes:
  - Root repo: Uses local path (verified with "Compiling gsnake-core v0.1.0 (/home/.../gsnake-core/engine/core)")
  - Standalone: Uses git dependency
- Documented override mechanism in README.md with detailed explanation
- Files changed: gsnake-levels/build.rs, gsnake-levels/.cargo/config.toml, gsnake-levels/Cargo.lock, gsnake-levels/README.md
- **Learnings for future iterations:**
  - gsnake-core is a **workspace**, not a simple package - must point to engine/core subdirectory
  - Cargo's [patch."<git-url>"] in .cargo/config.toml is the right way to override git dependencies locally
  - Need to clean cargo cache (~/.cargo/git) sometimes to see patch take effect
  - Detection should check for Cargo.toml existence, not .git (gsnake-core is not a submodule)
  - build.rs warnings are printed during compilation with "cargo:warning=" prefix
  - The override is transparent - developers don't need to do anything manually
  - Committed in submodule first, then updated submodule reference in root repo
---


## 2026-01-28 16:29 - US-008
- Implemented comprehensive CI workflow for gsnake-levels
- Created gsnake-levels/.github/workflows/ci.yml with two jobs:
  - **build**: Validates cargo build with Rust stable
  - **test**: Runs cargo test
- All jobs use actions/checkout@v4, dtolnay/rust-toolchain@stable
- Added caching for cargo registry, index, and build artifacts
- Workflow validates standalone builds using git dependency (not local path)
- Documented CI/CD section in README.md with nektos/act usage and limitations
- Files changed: gsnake-levels/.github/workflows/ci.yml, gsnake-levels/README.md
- **Learnings for future iterations:**
  - Follow the same pattern as gsnake-core CI workflow for consistency
  - gsnake-levels only needs build and test jobs (no WASM job)
  - nektos/act is not installed locally, but documented for future use
  - Workflow checkout uses `path: gsnake-levels` to maintain directory structure
  - CI workflow will use git dependency by default (no build.rs override in CI environment)
  - Document CI/CD section in README for consistency across submodules
---

## 2026-01-28 16:33 - US-009
- Committed WASM build artifacts to gsnake-core for standalone builds
- Built WASM package: wasm-pack build in gsnake-core/engine/bindings/wasm
- Removed auto-generated pkg/.gitignore that blocked committing artifacts
- Updated root .gitignore to add exception: !gsnake-core/engine/bindings/wasm/pkg/
- Committed all WASM files: package.json, gsnake_wasm_bg.wasm, .js, .d.ts files
- Updated gsnake-core/README.md "WASM Build Output" section to document committed pkg/
- Verified package.json has correct name (gsnake-wasm) and version (0.1.0)
- Files changed: .gitignore, gsnake-core/README.md, gsnake-core/engine/bindings/wasm/pkg/*
- **Learnings for future iterations:**
  - wasm-pack generates pkg/.gitignore with "*" that blocks committing - must be removed
  - Root .gitignore had "pkg/" pattern - needed exception with "!" prefix
  - WASM artifacts total ~210KB (gsnake_wasm_bg.wasm is ~170KB)
  - Committing build artifacts is necessary for git dependencies to work in JavaScript projects
  - package.json is auto-generated by wasm-pack from Cargo.toml metadata
  - The pkg/ name comes from the [package] name in Cargo.toml (gsnake-wasm)
  - This enables gsnake-web to use git+https://github.com/nntin/gsnake.git#main:gsnake-core/engine/bindings/wasm/pkg
---

## 2026-01-28 16:42 - US-010
- Prepared gsnake-web for standalone builds
- Simplified package.json build script: removed build:types and build:wasm dependencies
  - These required parent ../scripts which don't exist in standalone mode
  - WASM is now prebuilt and committed (US-009), so no rebuild needed
- Fixed WasmGameEngine.ts: replaced non-existent init() with init_panic_hook()
  - The WASM module auto-initializes via wasm.__wbindgen_start()
  - init_panic_hook() provides better error messages
- Kept file: dependency path for gsnake-wasm
- npm install, npm run check, and npm run build all pass
- Files changed: gsnake-web/package.json, gsnake-web/engine/WasmGameEngine.ts
- **Learnings for future iterations:**
  - npm does NOT support git dependencies for subdirectories (git+https://...#branch:path syntax doesn't work)
  - npm will clone the entire repo and look for package.json at root, not in subdirectory
  - For npm git dependencies to work, package needs to be at repo root or in separate repo
  - wasm-pack auto-initialization doesn't require manual init() call
  - The init() function was never exported by the WASM package - it was a mistake in WasmGameEngine.ts
  - Build scripts that reference parent directories (../scripts) won't work in standalone mode
  - For standalone builds, rely on prebuilt artifacts (committed WASM) rather than rebuild scripts
  - US-011 will add detection script to switch between file: and git dependencies as needed
---

## 2026-01-28 17:02 - US-011
- Created local dependency detection script for gsnake-web
- Implemented scripts/detect-local-deps.js with automatic root repo detection
  - Checks for ../.git and ../gsnake-core/Cargo.toml to detect root repository
  - In root repo: ensures package.json uses file:../gsnake-core/engine/bindings/wasm/pkg
  - In standalone: validates WASM package exists locally and provides helpful messages
  - Auto-updates package.json if needed (though in practice it's already correct)
- Added preinstall script to package.json: runs detection before every npm install
- Updated README.md with comprehensive Dependency Resolution section
- npm install, npm run check, and npm test all pass
- Files changed: gsnake-web/scripts/detect-local-deps.js, gsnake-web/package.json, gsnake-web/README.md
- **Learnings for future iterations:**
  - preinstall scripts run BEFORE npm reads package.json dependencies
  - This allows dynamic dependency configuration based on environment
  - Detection checks for Cargo.toml instead of .git (gsnake-core is not a submodule)
  - Script provides clear console output showing detected mode (root vs standalone)
  - In standalone mode, file: dependencies still work if the path exists locally
  - The detection script is defensive: verifies WASM pkg exists before proceeding
  - Exit code 1 from preinstall script aborts npm install (good for validation)
  - This pattern enables transparent local development without manual configuration
---

## 2026-01-28 17:06 - US-012
- Handled contract test fixtures for standalone gsnake-web builds
- Copied 8 fixture files from gsnake-core/engine/core/tests/fixtures to gsnake-web/tests/fixtures/
  - frame.json (sample game frame)
  - level.json (sample level definition)
  - error-invalid-input.json
  - error-input-rejected.json
  - error-serialization-failed.json
  - error-initialization-failed.json
  - error-internal-error.json
  - error-with-context.json
- Added "_comment" field to each JSON file identifying them as copies for standalone builds
- Updated tests/contract/fixtures.test.ts to use local ../fixtures path instead of ../../../gsnake-core
- All 41 tests pass in both root repo and standalone mode
- Documented fixture duplication in README.md "Contract Test Fixtures" section
- Typecheck passes
- Files changed: gsnake-web/tests/fixtures/* (8 files), gsnake-web/tests/contract/fixtures.test.ts, gsnake-web/README.md
- **Learnings for future iterations:**
  - Contract tests validate TypeScript types match Rust-generated JSON structure
  - JSON doesn't support comments, but can use "_comment" field at top of objects
  - Fixture duplication is necessary for standalone builds since npm can't fetch subdirectories
  - The fixtures are small (~2KB total) so duplication is acceptable
  - Tests use __dirname to resolve fixture paths relative to test file location
  - All ContractError kinds have dedicated fixture files for comprehensive testing
  - Fixtures ensure frontend-backend contract stays in sync across development
---

## 2026-01-28 17:09 - US-013
- Implemented comprehensive CI workflow for gsnake-web
- Created gsnake-web/.github/workflows/ci.yml with three jobs:
  - **build**: Validates npm run build (includes npm test via prebuild)
  - **typecheck**: Runs npm run check (svelte-check)
  - **test**: Runs npm test (vitest with 41 tests)
- All jobs use actions/checkout@v4, actions/setup-node@v4
- Node cache enabled via setup-node action's built-in caching (cache: 'npm')
- Each job is independent (does own checkout and npm ci) for reliability
- Workflow validates standalone builds - preinstall script will detect standalone mode in CI
- Documented CI/CD section in README.md with nektos/act usage and limitations
- Typecheck passes, all tests pass
- Files changed: gsnake-web/.github/workflows/ci.yml, gsnake-web/README.md
- **Learnings for future iterations:**
  - GitHub Actions jobs run on separate runners, so each needs its own setup
  - Node setup-node@v4 has built-in npm caching (cache: 'npm' parameter)
  - Checkout with path: gsnake-web maintains directory structure for submodule CI
  - Preinstall script will detect standalone mode in CI environment (no ../gsnake-core)
  - The workflow validates that gsnake-web can build without sibling repositories
  - nektos/act can test workflows locally but has limitations (cache, network, workflow_dispatch)
  - Following the same pattern as gsnake-core and gsnake-levels for consistency
---

## 2026-01-28 17:13 - US-014
- Added environment variable support for gsnake-editor web URL
- Implemented VITE_GSNAKE_WEB_URL environment variable
  - Default value: http://localhost:3000
  - Used in EditorLayout.svelte test level functionality
- Updated EditorLayout.svelte to use `import.meta.env.VITE_GSNAKE_WEB_URL || 'http://localhost:3000'`
- Created .env.example with documentation for the environment variable
- Updated README.md with Configuration section explaining VITE_GSNAKE_WEB_URL usage
- npm run build succeeds without env var (uses default)
- npm run build succeeds with VITE_GSNAKE_WEB_URL=https://example.com  
- Typecheck passes with 0 errors
- Files changed: gsnake-editor/.env.example, gsnake-editor/README.md, gsnake-editor/src/lib/EditorLayout.svelte
- **Learnings for future iterations:**
  - Vite environment variables must be prefixed with VITE_ to be exposed to client code
  - Use `import.meta.env.VITE_*` in Svelte/Vite projects (not process.env)
  - Always provide default values with || operator for optional environment variables
  - .env.example documents available environment variables for users
  - The Test button in editor posts level to localhost:3001, then opens web UI for testing
  - Hardcoded URL found at line 606 in EditorLayout.svelte - now made configurable
---

## 2026-01-28 17:30 - US-015
- Verified gsnake-editor has no sibling path references
- Comprehensive search found zero ../gsnake-web or ../gsnake-* imports
- All references to gsnake-web are via VITE_GSNAKE_WEB_URL environment variable (US-014)
- npm install succeeds in standalone mode
- npm run build succeeds in standalone mode (dist/ generated successfully)
- npm run check passes with 0 errors and 0 warnings
- No changes needed - gsnake-editor was already standalone-ready
- Files verified: package.json, vite.config.ts, server.ts, all .ts and .svelte files
- **Learnings for future iterations:**
  - gsnake-editor was designed independently from the start - no tight coupling to sibling repos
  - The only integration point is VITE_GSNAKE_WEB_URL for testing levels in the web UI
  - server.ts provides a standalone test level API (POST/GET /api/test-level) on port 3001
  - Editor UI runs on port 3003 (Vite), backend on port 3001, completely self-contained
  - US-014 had already addressed the web URL configuration, making US-015 validation-only
  - Some user stories may already be complete - verify first before making changes
---

## 2026-01-28 18:00 - US-016
- Implemented comprehensive CI workflow for gsnake-editor
- Created gsnake-editor/.github/workflows/ci.yml with two jobs:
  - **build**: Validates npm run build with Node 20
  - **typecheck**: Runs npm run check (svelte-check + tsc)
- No test job added since gsnake-editor has no test files yet
- All jobs use actions/checkout@v4, actions/setup-node@v4
- Added caching for npm via setup-node action's built-in cache parameter
- Documented CI/CD section in README.md with nektos/act usage and limitations
- Files changed: gsnake-editor/.github/workflows/ci.yml, gsnake-editor/README.md
- **Learnings for future iterations:**
  - gsnake-editor has no test script or test files - acceptance criteria mentioned tests but none exist yet
  - Followed the same pattern as gsnake-web CI workflow for consistency
  - Each job is independent (does own checkout and npm ci) for reliability
  - nektos/act is not installed locally, but documented for future use
  - Workflow uses path: gsnake-editor to maintain directory structure
  - gsnake-editor is a git submodule - changes committed in submodule first, then root repo updated
  - Typecheck uses svelte-check for .svelte files and tsc for .ts files
---
## 2026-01-29 10:45 - US-017
- Verified gsnake-specs builds standalone (no build tools required)
- Enhanced README.md with comprehensive documentation:
  - Repository overview and structure
  - Standalone build status
  - Documentation references vs build dependencies
  - Usage instructions and contributing guidelines
- Verified no broken internal links or external dependencies
- Files changed: gsnake-specs/README.md
- **Learnings for future iterations:**
  - gsnake-specs is pure markdown documentation - no build process exists or is needed
  - References to `../gsnake-*` in docs are **documentation references** (describing architecture), not build dependencies
  - No mkdocs.yml, requirements.txt, or pyproject.toml - no Python build tools
  - No npm/cargo - this is purely a documentation repository
  - "Typecheck passes" for docs-only repos means verifying markdown syntax is valid
  - Documentation repositories can reference sibling repos in content without creating build dependencies
  - gsnake-specs was already standalone-ready - only needed better documentation
  - Committed in submodule (gsnake-specs main branch), then updated submodule reference in root repo
---
## 2026-01-29 10:52 - US-018
- Implemented comprehensive CI workflow for gsnake-specs documentation
- Created gsnake-specs/.github/workflows/ci.yml with three jobs:
  - **markdown-lint**: Validates Markdown syntax using markdownlint-cli (warnings only, no hard failures)
  - **link-check**: Checks for broken links using markdown-link-check (tolerant of external link failures)
  - **validate**: Verifies repository structure - checks all expected directories and README.md exist
- Created .markdown-link-check.json: Configuration to handle localhost URLs and retries
- Updated README.md with comprehensive CI/CD section:
  - GitHub Actions workflow documentation
  - nektos/act local testing instructions
  - Manual validation commands
- Files changed: gsnake-specs/.github/workflows/ci.yml, gsnake-specs/.markdown-link-check.json, gsnake-specs/README.md
- **Learnings for future iterations:**
  - gsnake-specs is a documentation-only repository - no build tools needed (no mkdocs, no Python)
  - CI for docs repos should be tolerant (warnings, not failures) to avoid blocking on minor issues
  - markdownlint and markdown-link-check are standard tools for Markdown validation
  - Link checking should ignore localhost URLs and allow retries for external links (rate limits)
  - The validate job ensures repository structure integrity (all expected directories present)
  - gsnake-specs contains 66 markdown files across 10 topic directories
  - nektos/act can test workflows locally but has known limitations with network/cache behavior
  - Documentation CI is lightweight - no npm install or cargo build needed, just validation tools
---
## 2026-01-29 10:55 - US-019
- Created root repo context detection script: scripts/detect-repo-context.sh
- Script detects root repository by checking:
  - ../.git exists (we're in a submodule or subdirectory)
  - ../gsnake-core exists (gsnake-core is part of root, not a submodule)
- Exports environment variables:
  - GSNAKE_ROOT_REPO=true/false
  - GSNAKE_CORE_PATH, GSNAKE_LEVELS_PATH, GSNAKE_WEB_PATH, GSNAKE_EDITOR_PATH, GSNAKE_SPECS_PATH (if available)
- Script provides clear console output showing detected mode
- Made executable with chmod +x
- Updated root README.md with Developer Documentation section:
  - Repository structure overview
  - Submodule dependency resolution explanation
  - Auto-detection mechanism usage example
  - Building instructions for both modes
- Tested detection from gsnake-web submodule - correctly detects root repo
- Files changed: scripts/detect-repo-context.sh, README.md
- **Learnings for future iterations:**
  - gsnake-core is NOT a submodule - it's part of the root repo (no .git)
  - Detection should check for ../gsnake-core directory existence, not ../gsnake-core/.git
  - Actual submodules: gsnake-editor, gsnake-levels, gsnake-web, gsnake-specs, gsnake-python
  - Script uses set -e for safety and provides informative output for debugging
  - The script can be sourced from any submodule build script: source ../../scripts/detect-repo-context.sh
  - Environment variables are exported so they persist in the calling shell
  - [ -d ] checks for directory existence, [ -e ] checks for any file/directory existence
---
## 2026-01-29 10:59 - US-020
- Updated root repo build scripts with context detection documentation
- Modified scripts/build_wasm.py:
  - Added comprehensive docstring explaining dependency resolution
  - Added explicit check for gsnake-core existence (root repo validation)
  - Added clear error messages if not in root repo context
  - Added informative output showing build location
- Modified scripts/generate_ts_types.py:
  - Added comprehensive docstring explaining dependency resolution
  - Added explicit check for gsnake-core existence (root repo validation)
  - Added clear error messages if not in root repo context
  - Added informative output showing where types are generated from
- Both scripts tested and working correctly
- Files changed: scripts/build_wasm.py, scripts/generate_ts_types.py
- **Learnings for future iterations:**
  - These scripts inherently work in root repo context only
  - gsnake-core is part of the root repository (not a submodule), so these scripts don't need conditional git vs local logic
  - The "detection" is really validation that we're in the correct context
  - Python scripts use Path(__file__).resolve().parent.parent to find root directory
  - Added .exists() checks to fail gracefully with helpful messages if gsnake-core not found
  - Docstrings document that these are root-repo-only scripts
  - This is different from submodule build scripts which need actual dual-mode detection
---
