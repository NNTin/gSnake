{
  "project": "gSnake",
  "description": "Automated Level Metadata Synchronization and Validation - Migrate levels from string to numeric IDs, auto-generate metadata, create playback solutions, and add CI validation",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add ID migration helper function to read and parse string IDs",
      "description": "As a developer, I need a helper function to extract numeric IDs from string-based IDs so that level files can be migrated.",
      "acceptanceCriteria": [
        "Create function that parses string IDs like '1769977122223-g36bwe'",
        "Extract timestamp portion (1769977122223) as u32",
        "Verify extracted timestamp fits within u32 range (0 to 4,294,967,295)",
        "Return error if ID format is invalid or timestamp out of range",
        "Add unit tests for valid and invalid ID formats",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement level JSON ID migration logic",
      "description": "As a developer, I need to update level JSON files from string to numeric IDs so they can be parsed by gsnake-core.",
      "acceptanceCriteria": [
        "Read level JSON files with string IDs",
        "Use US-001 helper to extract numeric ID",
        "Update 'id' field to numeric value",
        "Preserve all other fields (name, difficulty, gridSize, snake, obstacles, food, etc.)",
        "Write updated JSON back to file with proper formatting",
        "Validate migrated levels parse successfully with LevelDefinition",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create level analysis module for name generation",
      "description": "As a developer, I need a module to analyze level mechanics so creative names can be generated.",
      "acceptanceCriteria": [
        "Create analysis function that reads level JSON",
        "Identify presence of: floatingFood, fallingFood, stones, spikes",
        "Detect obstacle patterns (vertical walls, horizontal walls, scattered)",
        "Calculate grid complexity metrics (obstacle density, food count)",
        "Return structured analysis result (mechanics present, patterns detected)",
        "Add unit tests for different level configurations",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement creative name generator based on level analysis",
      "description": "As a developer, I need to generate descriptive level names from analysis results so levels are identifiable.",
      "acceptanceCriteria": [
        "Use US-003 analysis to generate names",
        "Priority 1: Special mechanics (Floating/Falling/Stones/Spikes)",
        "Priority 2: Obstacle patterns (Tower/Bridge/Zigzag/Islands)",
        "Priority 3: Complexity indicators for modifiers",
        "Generate 1-4 word gameplay-descriptive names",
        "Ensure uniqueness by tracking generated names across difficulties",
        "Update level JSON 'name' field from 'todoname' to generated name",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create levels.toml generation logic",
      "description": "As a developer, I need to auto-generate levels.toml files from level JSON files so metadata stays synchronized.",
      "acceptanceCriteria": [
        "Scan levels/{easy,medium,hard}/ directories for .json files",
        "For each level, create TOML entry with: id, file, author='gsnake', solved=true, difficulty, tags=[], description",
        "Use level filename for 'file' field and 'id' field",
        "Use generated name from US-004 for 'description' field",
        "Fail with clear error if JSON file doesn't exist",
        "Write levels.toml to levels/{difficulty}/levels.toml",
        "Format TOML with proper indentation using toml crate",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Update solve_level max_depth to 500",
      "description": "As a developer, I need to increase solver depth to handle complex levels.",
      "acceptanceCriteria": [
        "Update solve_level binary to use max_depth=500 as default",
        "Keep max_depth as CLI argument for flexibility",
        "Update help text to reflect new default",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Implement playback generation for all levels",
      "description": "As a developer, I need to generate playback solutions so levels can be verified and replayed.",
      "acceptanceCriteria": [
        "Run solve_level binary for each migrated level JSON",
        "Save playback to playbacks/{difficulty}/ with matching filename",
        "If solve succeeds, playback JSON created successfully",
        "If solve fails, log warning with level ID but continue processing",
        "Return list of solved/unsolved level IDs",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Update levels.toml solved status based on playback generation",
      "description": "As a developer, I need to mark levels as solved/unsolved based on whether playbacks were generated.",
      "acceptanceCriteria": [
        "After US-007 playback generation, update levels.toml entries",
        "Set solved=true for levels with successful playback generation",
        "Set solved=false for levels where solve_level failed",
        "Write updated levels.toml files",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Add sync-metadata subcommand",
      "description": "As a developer, I want to run metadata sync independently so I can update metadata without generating levels.json.",
      "acceptanceCriteria": [
        "Add 'sync-metadata' subcommand to main.rs using clap",
        "Accept optional --difficulty <easy|medium|hard> flag",
        "Default syncs all difficulties if no flag provided",
        "Run operations in order: migrate IDs (US-002), generate names (US-004), create levels.toml (US-005), generate playbacks (US-007), update solved status (US-008)",
        "Report summary: 'Migrated X IDs, generated X names, updated X levels.toml files, created X playbacks'",
        "Exit code 0 on success, non-zero on failure",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Integrate sync into generate-levels-json command",
      "description": "As a developer, I want metadata sync to run automatically when generating levels.json so output uses up-to-date metadata.",
      "acceptanceCriteria": [
        "Add --sync flag to generate-levels-json subcommand",
        "Add --no-sync flag to disable auto-sync",
        "Run sync by default (unless --no-sync passed)",
        "Call US-009 sync-metadata logic before level aggregation",
        "Log sync progress (migrating, naming, updating, generating playbacks)",
        "If sync fails, abort generate-levels-json with error",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Add validate-levels-toml subcommand",
      "description": "As a developer, I need a validation command for CI to check levels.toml integrity.",
      "acceptanceCriteria": [
        "Add 'validate-levels-toml' subcommand to main.rs",
        "For each difficulty (easy, medium, hard):",
        "- Check levels.toml exists and is valid TOML format",
        "- Verify all referenced JSON files exist",
        "- Parse all JSON files as valid LevelDefinition",
        "Fail immediately on first validation error with clear message including file path",
        "Exit code 0 if all valid, 1 on validation failure, 2 on IO error, 3 on parse error",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add CI validation job to gsnake-levels workflow",
      "description": "As a developer, I want CI to validate levels.toml files so invalid metadata is caught before merge.",
      "acceptanceCriteria": [
        "Add 'validate-levels' job to .github/workflows/ci.yml",
        "Job runs on push and pull_request events",
        "Use same setup as build/test jobs (checkout, rust toolchain, cargo config)",
        "Run 'cargo run -- validate-levels-toml' in working directory",
        "Job fails CI if validation command returns non-zero exit code",
        "Add to existing jobs (after build and test)",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Execute full migration on all 9 level files",
      "description": "As a developer, I need to run the complete sync-metadata command to migrate all new levels.",
      "acceptanceCriteria": [
        "Run 'cargo run -- sync-metadata' from gsnake-levels directory",
        "Verify all 9 level files (2 easy, 3 medium, 3 hard) are migrated to numeric IDs",
        "Verify all levels have creative generated names (no 'todoname' remaining)",
        "Verify levels.toml files created in all three difficulty folders",
        "Verify playback JSON files created for all solvable levels",
        "Verify all migrated levels parse successfully with gsnake-core LevelDefinition",
        "Commit changes with message: 'feat: US-013 - Execute full migration on all 9 level files'",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Migration completed successfully. 8 level files migrated (not 9 as stated in description), IDs 13-20 assigned, all names generated, 6 playbacks created (2 hard levels unsolvable within depth 500)."
    },
    {
      "id": "US-014",
      "title": "Update gsnake-core levels.json with new levels",
      "description": "As a developer, I need to regenerate levels.json so gsnake-core includes the new migrated levels.",
      "acceptanceCriteria": [
        "Run 'cargo run -- generate-levels-json > ../../gsnake-core/engine/core/data/levels.json' from gsnake-levels",
        "Verify levels.json contains all 12 existing levels plus 9 new levels (21 total)",
        "Verify new levels have numeric IDs and generated names",
        "Verify JSON is properly formatted",
        "Commit changes with message: 'feat: US-014 - Update gsnake-core levels.json with new levels'",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    }
  ]
}
