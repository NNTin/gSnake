# Ralph Progress Log
Started: Tue Jan 27 22:11:52 CET 2026
## Codebase Patterns
- **Git Dependencies**: Use branch-based git dependencies for submodules (not tags/commits)
- **Auto-detection**: Build scripts check for ../.git and sibling submodules to detect root repo context
- **Rust Overrides**: Use .cargo/config.toml with [patch] section to override git deps with local paths
- **JavaScript Overrides**: Use preinstall scripts to dynamically modify package.json based on detection
- **CI Strategy**: Per-submodule CI validates standalone builds; root CI validates integration
- **nektos/act**: Use act for local CI testing - compatible with standard GitHub Actions
- **Documentation Location**: gsnake-specs/tasks/repo-architecture.md is the central doc for dependency architecture
- **"Typecheck passes"**: For markdown-only changes, this means ensuring valid markdown syntax (no specific command)
---

## 2026-01-27 22:15 - US-001
- Implemented comprehensive "Dependency Resolution Strategy" section in gsnake-specs/tasks/repo-architecture.md
- Files changed: gsnake-specs/tasks/repo-architecture.md
- **Learnings for future iterations:**
  - The repo-architecture.md file is the central documentation for dependency management
  - Documentation should include both Rust (Cargo.toml) and JavaScript (package.json) examples
  - Auto-detection mechanism is a key feature: checks for ../.git to determine root repo context
  - Acceptance criteria "Typecheck passes" refers to ensuring markdown syntax is valid (no specific typecheck command in root)
---

## 2026-01-27 22:17 - US-002
- Implemented comprehensive "Troubleshooting" section in gsnake-specs/tasks/repo-architecture.md
- Files changed: gsnake-specs/tasks/repo-architecture.md
- **Learnings for future iterations:**
  - Troubleshooting section covers 5 main categories: git deps not found, local override not working, WASM build fails, forcing standalone mode, verifying dependency mode
  - Each troubleshooting item includes symptoms, causes/solutions, and verification commands
  - Important to provide both Rust and JavaScript examples for verification commands
---

## 2026-01-27 22:20 - US-003
- Updated architecture Mermaid diagram in gsnake-specs/tasks/repo-architecture.md
- Files changed: gsnake-specs/tasks/repo-architecture.md
- **Learnings for future iterations:**
  - Mermaid diagram now clearly shows two modes: Root Repository (local paths) and Standalone (git deps)
  - Used emojis (üè† and üåê) and color coding to visually distinguish the modes
  - Removed old "cannot build alone" pain points - now marked as resolved
  - Added legend explaining dependency types
  - Diagram is more focused and easier to understand than the previous version
---

## 2026-01-27 23:00 - US-004
- Validated gsnake-core standalone build capabilities
- All build commands tested and passed:
  - cargo build: successful
  - cargo test: 62 tests passed
  - cargo doc --no-deps: documentation generated
  - wasm-pack build: WASM bindings compiled successfully
- Updated gsnake-core/README.md with comprehensive standalone build instructions
- Files changed: gsnake-core/README.md, scripts/ralph/prd.json, scripts/ralph/progress.txt
- **Learnings for future iterations:**
  - gsnake-core is a Rust workspace with 3 members (core, cli, wasm)
  - Profile warnings for non-root packages in workspaces are expected and harmless
  - WASM build requires wasm-pack and wasm32-unknown-unknown target
  - WASM output goes to engine/bindings/wasm/pkg/
  - All tests run in workspace context (62 total tests across all crates)
  - The README should document prerequisites, build commands, and known issues
  - gsnake-core has no external git dependencies - all dependencies are from crates.io
---

## 2026-01-27 23:00 - US-005
- Implemented comprehensive CI workflow for gsnake-core
- Created gsnake-core/.github/workflows/ci.yml with three jobs:
  - **build**: Validates cargo build with Rust stable
  - **test**: Runs cargo test on all workspace crates
  - **wasm**: Builds WASM bindings with wasm-pack
- All jobs use actions/checkout@v4, dtolnay/rust-toolchain@stable
- Added caching for cargo registry, index, and build artifacts for faster CI runs
- Tested workflow syntax validation with nektos/act dryrun
- Files changed: gsnake-core/.github/workflows/ci.yml, gsnake-core/README.md
- **Learnings for future iterations:**
  - gsnake-core is NOT a git submodule - it's a directory in the root repo (no .git file/dir)
  - Changes must be committed from root repo, not from within gsnake-core directory
  - nektos/act requires Docker and interactive configuration on first run
  - act config file location: ~/.config/act/actrc
  - Use medium-sized image: `ghcr.io/catthehacker/ubuntu:act-latest` (~500MB)
  - act dryrun is useful for validating workflow syntax without running full jobs
  - Known act limitations: cache actions may not work exactly as on GitHub, network operations differ
  - CI workflow should checkout to `path: gsnake-core` to maintain directory structure
  - workflow_dispatch trigger cannot be tested locally with act
  - Added CI/CD section to README.md with act usage instructions and limitations
---

## 2026-01-27 23:05 - US-006
- Updated gsnake-levels/Cargo.toml to use git dependency for gsnake-core
- Git dependency format: `git = "https://github.com/nntin/gsnake", branch = "main", package = "gsnake-core"`
- Created .cargo/config.toml with `git-fetch-with-cli = true` to handle SSH submodule authentication
- Updated render.rs to gracefully handle standalone mode (checks if sibling gsnake-core exists)
- cargo build, cargo test, and cargo check all pass successfully
- Files changed: gsnake-levels/Cargo.toml, gsnake-levels/Cargo.lock, gsnake-levels/.cargo/config.toml, gsnake-levels/README.md, gsnake-levels/src/render.rs
- **Learnings for future iterations:**
  - gsnake-levels IS a git submodule (unlike gsnake-core) - changes must be committed in submodule, then root
  - Git dependencies that point to repos with SSH submodules require `git-fetch-with-cli = true` in .cargo/config.toml
  - The gsnake repo has SSH submodules (git@github.com URLs) which cause cargo authentication issues without git-fetch-with-cli
  - render.rs `replay` and `render` commands need sibling gsnake-core - updated to check path exists and provide helpful error
  - Best practice: check for sibling paths at runtime and provide clear error messages for standalone vs root repo contexts
  - Document git dependency configuration and root repo requirements in README.md
---

## 2026-01-27 23:15 - US-007
- Implemented local override detection for gsnake-levels via build.rs
- Created build.rs that auto-detects root repository context by checking:
  - ../.git exists (root repo)
  - ../gsnake-core/Cargo.toml exists (sibling directory, not .git since gsnake-core is not a submodule)
- Build script generates .cargo/config.toml with [patch] section pointing to ../gsnake-core/engine/core
- Cargo build succeeds in both modes:
  - Root repo: Uses local path (verified with "Compiling gsnake-core v0.1.0 (/home/.../gsnake-core/engine/core)")
  - Standalone: Uses git dependency
- Documented override mechanism in README.md with detailed explanation
- Files changed: gsnake-levels/build.rs, gsnake-levels/.cargo/config.toml, gsnake-levels/Cargo.lock, gsnake-levels/README.md
- **Learnings for future iterations:**
  - gsnake-core is a **workspace**, not a simple package - must point to engine/core subdirectory
  - Cargo's [patch."<git-url>"] in .cargo/config.toml is the right way to override git dependencies locally
  - Need to clean cargo cache (~/.cargo/git) sometimes to see patch take effect
  - Detection should check for Cargo.toml existence, not .git (gsnake-core is not a submodule)
  - build.rs warnings are printed during compilation with "cargo:warning=" prefix
  - The override is transparent - developers don't need to do anything manually
  - Committed in submodule first, then updated submodule reference in root repo
---


## 2026-01-28 16:29 - US-008
- Implemented comprehensive CI workflow for gsnake-levels
- Created gsnake-levels/.github/workflows/ci.yml with two jobs:
  - **build**: Validates cargo build with Rust stable
  - **test**: Runs cargo test
- All jobs use actions/checkout@v4, dtolnay/rust-toolchain@stable
- Added caching for cargo registry, index, and build artifacts
- Workflow validates standalone builds using git dependency (not local path)
- Documented CI/CD section in README.md with nektos/act usage and limitations
- Files changed: gsnake-levels/.github/workflows/ci.yml, gsnake-levels/README.md
- **Learnings for future iterations:**
  - Follow the same pattern as gsnake-core CI workflow for consistency
  - gsnake-levels only needs build and test jobs (no WASM job)
  - nektos/act is not installed locally, but documented for future use
  - Workflow checkout uses `path: gsnake-levels` to maintain directory structure
  - CI workflow will use git dependency by default (no build.rs override in CI environment)
  - Document CI/CD section in README for consistency across submodules
---

## 2026-01-28 16:33 - US-009
- Committed WASM build artifacts to gsnake-core for standalone builds
- Built WASM package: wasm-pack build in gsnake-core/engine/bindings/wasm
- Removed auto-generated pkg/.gitignore that blocked committing artifacts
- Updated root .gitignore to add exception: !gsnake-core/engine/bindings/wasm/pkg/
- Committed all WASM files: package.json, gsnake_wasm_bg.wasm, .js, .d.ts files
- Updated gsnake-core/README.md "WASM Build Output" section to document committed pkg/
- Verified package.json has correct name (gsnake-wasm) and version (0.1.0)
- Files changed: .gitignore, gsnake-core/README.md, gsnake-core/engine/bindings/wasm/pkg/*
- **Learnings for future iterations:**
  - wasm-pack generates pkg/.gitignore with "*" that blocks committing - must be removed
  - Root .gitignore had "pkg/" pattern - needed exception with "!" prefix
  - WASM artifacts total ~210KB (gsnake_wasm_bg.wasm is ~170KB)
  - Committing build artifacts is necessary for git dependencies to work in JavaScript projects
  - package.json is auto-generated by wasm-pack from Cargo.toml metadata
  - The pkg/ name comes from the [package] name in Cargo.toml (gsnake-wasm)
  - This enables gsnake-web to use git+https://github.com/nntin/gsnake.git#main:gsnake-core/engine/bindings/wasm/pkg
---
