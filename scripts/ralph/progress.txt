# Ralph Progress Log
Started: Fri Feb 20 09:53:43 CET 2026
## Codebase Patterns
- For `gsnake-levels validate-levels-toml`, keep validation output aggregated and deterministic (`[io]`, `[parse]`, `[validation]` with numbered lines) so one run reports all actionable issues and tests can assert stable CLI output.
- For `gsnake-levels` playback generation, keep `sync-metadata` and `solve_level` aligned through `solver::solve_level_to_playback(...)` so playback JSON format cannot drift and per-level `cargo` subprocess overhead is avoided.
- In `gsnake-core` stone push logic, keep `stone_mechanics::is_space_available` aligned with gravity occupancy rules by treating all food variants plus the exit tile as blocking cells.
- In `gsnake-core/engine/bindings/wasm`, regenerate committed `pkg/` artifacts with `wasm-pack build --target bundler` whenever Rust binding code or dependency wiring changes.
---
## [2026-02-20 09:55:34 CET] - US-001
- Implemented US-001 by updating `stone_mechanics::is_space_available` to block stone pushes into regular food, floating food, falling food, and the exit tile.
- Added regression tests covering blocked pushes into `food`, `floating_food`, `falling_food`, and the exit tile (including `exit_is_solid = false` behavior).
- Ran quality checks in `gsnake-core`: `cargo fmt --all`, `cargo clippy -p gsnake-core --all-targets -- -D warnings`, and `cargo test -p gsnake-core`.
- Files changed: `gsnake-core/engine/core/src/stone_mechanics.rs`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`, `CLAUDE.md`
- **Learnings for future iterations:**
  - Stone push occupancy rules should mirror gravity support rules to avoid divergent behavior between horizontal pushes and vertical settling.
  - `stone_mechanics` unit tests are the fastest regression surface for push-blocking semantics; keep focused tests there when adding occupancy constraints.
  - `cargo test -p gsnake-core` covers both unit and contract/property suites relevant to engine behavior changes.
---
## [2026-02-20 09:58:02 CET] - US-002
- Implemented US-002 by removing the unmaintained `wee_alloc` dependency and deleting the WASM `#[global_allocator]` declaration so the crate uses Rustâ€™s default WASM allocator.
- Rebuilt WASM bundler artifacts after the allocator change and validated no API surface changes were introduced.
- Ran quality checks in `gsnake-core`: `cargo fmt --all`, `cargo clippy -p gsnake-wasm --all-targets -- -D warnings`, `cargo test -p gsnake-wasm`, `cargo test -p gsnake-core`, and `wasm-pack build --target bundler`.
- Files changed: `gsnake-core/engine/bindings/wasm/Cargo.toml`, `gsnake-core/engine/bindings/wasm/src/lib.rs`, `gsnake-core/engine/bindings/wasm/pkg/gsnake_wasm.d.ts`, `gsnake-core/engine/bindings/wasm/pkg/gsnake_wasm.js`, `gsnake-core/engine/bindings/wasm/pkg/gsnake_wasm_bg.js`, `gsnake-core/engine/bindings/wasm/pkg/gsnake_wasm_bg.wasm`, `gsnake-core/engine/bindings/wasm/pkg/package.json`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`
- **Learnings for future iterations:**
  - `gsnake-wasm` keeps checked-in generated outputs under `engine/bindings/wasm/pkg`; dependency/runtime wiring changes in Rust should always be followed by `wasm-pack build --target bundler`.
  - The workspace emits a non-blocking Cargo warning about package-local profiles in `engine/bindings/wasm/Cargo.toml`; treat it as informational unless workspace profile ownership is being refactored.
  - `cargo test -p gsnake-wasm` provides fast feedback for binding-layer regressions before running broader `gsnake-core` suites.
---
